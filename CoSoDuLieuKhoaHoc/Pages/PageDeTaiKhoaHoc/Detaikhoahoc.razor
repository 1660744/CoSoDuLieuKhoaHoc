<h3>Detaikhoahoc</h3>
@page "/DeTaiKhoaHoc"
@using Microsoft.AspNetCore.Authorization
@using CoSoDuLieuKhoaHoc.ViewModel
@using Microsoft.EntityFrameworkCore;
@using CoSoDuLieuKhoaHoc.Models

@using CoSoDuLieuKhoaHoc.DataServices
@inject QLKhoaHocContext Dbcontext
    <div id="titletop" class="top-row px-4" style="background-color:#072565">

        <div class="col-xs-12 col-sm-8 col-md-9">

            <h2 id="ttid" style="text-align:center; margin-top:10px;margin-left:1px;margin-right:1px;color: #005882;font-size: 35px;font-weight:bold;font-family:'Times New Roman'" class="font-weight-800">
                <a class="title text-white text-sm-center ">
                    CƠ SỞ DỮ LIỆU KHOA HỌC VÀ CÔNG NGHỆ
                </a>
            </h2>
        </div>
        <div class="d-flex justify-content-end">
            <div id="btnlogin">
                <a href="/Login" class="btnlogin">LOGIN</a>
            </div>
            <div>
                <a id="btninf" <img class="infom" src="images/user.png" alt="Image"></a>
            </div>
        </div>
    </div>
    <div class="imgbackrounddiv">
        <br />
        <br />
        <br />

        <div class="main">
            <div class="d-flex justify-content-center mt-2">
                <div class="nkhbtn">
                    <RadzenLink Path="/NhaKhoaHoc" Text="NHÀ KHOA HỌC" />
                </div>


                <div class="nkhbtn">
                    <RadzenLink Path="/DeTaiKhoaHoc" Text="ĐỀ TÀI KHOA HỌC" />
                </div>

                <div class="nkhbtn">
                    <RadzenLink Path="/BaiBaoKhoaHoc" Text="BÀI BÁO KHOA HỌC" />
                </div>

                <div class="nkhbtn">
                    <RadzenLink Path="/sachvagiaotrinh" Text="SÁCH, GIÁO TRÌNH" />
                </div>
            </div>
            <div class="timkiem">

            </div>
        </div>
        <br />
        <br />
    </div>

    <div class="=main">
        @code
{
            bool hidden = true;
        }

        <div class="card">
            <div class="card-header">
                <button @onclick=@(()=>hidden=!hidden)>@(hidden ? "Play" : "Stop")</button>

            </div>
            <div class="card-body">
                @if (!hidden)
                {
                    <audio autoplay controls><source src="/images/mom.mp3" /></audio>
                }
                else
                {
                    <audio autoplay controls><source src="/images/mom.mp3" /></audio>
                }
            </div>
        </div>
        <RadzenGrid @ref="ordersGrid" AllowFiltering="true" AllowPaging="true" PageSize="10" AllowSorting="true" EditMode="DataGridEditMode.Single"
                    Data="@nkhvmd" TItem="DeTaiKhoaHocViewModel" ColumnWidth="150px">
            <Columns>
                <RadzenGridColumn Width="100px" TItem="DeTaiKhoaHocViewModel" Property="MaDeTai" Title="Mã Đề Tài" CssClass="test" />
                <RadzenGridColumn Width="200px" TItem="DeTaiKhoaHocViewModel" Property="MaDeTaiHoSo" Title="Mã Đề Tài Hồ Sơ" />
                <RadzenGridColumn Width="100px" TItem="DeTaiKhoaHocViewModel" Property="TenDeTai" Title="Tên Đề Tài" />
                <RadzenGridColumn Width="100px" TItem="DeTaiKhoaHocViewModel" Property="MaLoaiDeTai" Title="Mã Loại Đề Tài" />
                <RadzenGridColumn Width="160px" TItem="DeTaiKhoaHocViewModel" Property="MaCapDeTai" Title="Mã Cấp Đề Tài" />
                <RadzenGridColumn Width="160px" TItem="DeTaiKhoaHocViewModel" Property="TenCapDeTai" Title="Tên Cấp Đề Tài" />
                <RadzenGridColumn Width="200px" TItem="DeTaiKhoaHocViewModel" Property="MaDvchuTri" Title="Mã Đơn Vị Chu Trì" />
                <RadzenGridColumn Width="130px" TItem="DeTaiKhoaHocViewModel" Property="MaDonViQlthucHien" Title="Mã Đơn Vị Quản Lí Thực Hiện" />
                <RadzenGridColumn Width="130px" TItem="DeTaiKhoaHocViewModel" Property="MaLinhVuc" Title="Mã Lĩnh Vực" />
                <RadzenGridColumn Width="130px" TItem="DeTaiKhoaHocViewModel" Property="MucTieuDeTai" Title="Mụ Tiêu Đề Tài" />
                <RadzenGridColumn Width="100px" TItem="DeTaiKhoaHocViewModel" Property="NoiDungDeTai" Title="Nội Dung Đề Tài" />
                <RadzenGridColumn Width="100px" TItem="DeTaiKhoaHocViewModel" Property="KetQuaDeTai" Title="Kết Quả Đề Tài" />
                <RadzenGridColumn Width="100px" TItem="DeTaiKhoaHocViewModel" Property="NamBd" Title="Năm Bắt Đầu" />
                <RadzenGridColumn Width="100px" TItem="DeTaiKhoaHocViewModel" Property="NamKt" Title="Năm Kết Thúc" />
                <RadzenGridColumn Width="100px" TItem="DeTaiKhoaHocViewModel" Property="MaXepLoai" Title="Mã Xếp Loại" />
                <RadzenGridColumn Width="100px" TItem="DeTaiKhoaHocViewModel" Property="MaTinhTrang" Title="Mã Tình Trạng" />
                <RadzenGridColumn Width="100px" TItem="DeTaiKhoaHocViewModel" Property="MaPhanLoaiSp" Title="Mã Loại SP" />
                <RadzenGridColumn Width="100px" TItem="DeTaiKhoaHocViewModel" Property="LienKetWeb" Title="Liên Kết WebSite" />
                <RadzenGridColumn Width="100px" TItem="DeTaiKhoaHocViewModel" Property="LinkFileUpload" Title="Link UpLoad" />
                <RadzenGridColumn Width="100px" TItem="DeTaiKhoaHocViewModel" Property="CoQuanTaiTro" Title="Cơ Quan Tài Trợ" />
                <RadzenGridColumn TItem="DeTaiKhoaHocViewModel" Context="Dbcontext" Bubble="false" Filterable="false" Sortable="false" TextAlign="TextAlign.Center" Width="100px">
                    <Template Context="order">
                        <RadzenButton Icon="edit" Size="ButtonSize.Small" Click="@(args => EditRow(order))">
                        </RadzenButton>
                    </Template>
                    <EditTemplate Context="order">
                        <RadzenButton Icon="save" Size="ButtonSize.Small" Click="@((args) => SaveRow(order))">
                        </RadzenButton>
                        <RadzenButton Icon="cancel" Size="ButtonSize.Small" ButtonStyle="ButtonStyle.Secondary" Click="@((args) => CancelEdit(order))">
                        </RadzenButton>
                    </EditTemplate>
                </RadzenGridColumn>
                <RadzenGridColumn TItem="DeTaiKhoaHocViewModel" Context="order" Bubble="false" Filterable="false" Sortable="false" TextAlign="TextAlign.Center" Width="70px">
                    <Template Context="order">
                        <RadzenButton ButtonStyle="ButtonStyle.Danger" Icon="close" Size="ButtonSize.Small" Click="@(args => DeleteRow(order))">
                        </RadzenButton>
                    </Template>
                    <EditTemplate Context="order">
                        <RadzenButton ButtonStyle="ButtonStyle.Danger" Icon="close" Size="ButtonSize.Small" Click="@(args => DeleteRow(order))">
                        </RadzenButton>
                    </EditTemplate>
                </RadzenGridColumn>
            </Columns>
        </RadzenGrid>
    </div>
    @code {
        RadzenGrid<DeTaiKhoaHocViewModel> ordersGrid;
        IList<DeTaiKhoaHocViewModel> orders;
        IEnumerable<CoSoDuLieuKhoaHoc.MyInterface.INhaKhoaHocManager> GetListNhaKhoaHoc;
        List<DeTaiKhoaHocViewModel> nkhvmd = new List<DeTaiKhoaHocViewModel>();
        DataDeTaiKhoaHocServices dt = new DataDeTaiKhoaHocServices();

        protected override async Task OnInitializedAsync()
        {
            nkhvmd = await dt.GetListDeTaiKhoHoc();

        }
        void EditRow(DeTaiKhoaHocViewModel order)
        {
            ordersGrid.EditRow(order);
        }

        void OnUpdateRow(DeTaiKhoaHocViewModel order)
        {
            Dbcontext.Update<DeTaiKhoaHocViewModel>(order);
        }

        void SaveRow(DeTaiKhoaHocViewModel order)
        {
            ordersGrid.UpdateRow(order);
        }

        void CancelEdit(DeTaiKhoaHocViewModel order)
        {
            ordersGrid.CancelEditRow(order);

            // For production
            var orderEntry = Dbcontext.Entry(order);
            orderEntry.CurrentValues.SetValues(orderEntry.OriginalValues);
            orderEntry.State = EntityState.Unchanged;
        }

        void DeleteRow(DeTaiKhoaHocViewModel order)
        {
            Dbcontext.Remove<DeTaiKhoaHocViewModel>(order);

            // For demo purposes only
            orders.Remove(order);

            // For production
            //dbContext.SaveChanges();

            ordersGrid.Reload();
        }
    }